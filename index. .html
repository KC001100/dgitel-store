<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mini Commerce â€” Firebase</title>
  <style>
    body{font-family:sans-serif;background:#0f1724;color:#e6eef6;margin:0}
    header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#081226}
    .btn{padding:6px 12px;border:none;border-radius:6px;background:#06b6d4;color:#012;cursor:pointer;margin:2px}
    .btn.ghost{background:transparent;border:1px solid #555;color:#ccc}
    .container{max-width:1100px;margin:auto;padding:20px}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
    .product{background:rgba(255,255,255,0.05);padding:12px;border-radius:8px}
    .product img{width:100%;height:180px;object-fit:cover;border-radius:8px}
    .product h3{margin:6px 0}
    .sidebar{position:fixed;top:0;right:0;width:320px;height:100%;background:#081226;padding:16px;overflow:auto;transform:translateX(100%);transition:.3s}
    .sidebar.open{transform:translateX(0)}
    .cart-item{display:flex;gap:8px;margin-bottom:10px}
    .cart-item img{width:60px;height:60px;object-fit:cover;border-radius:6px}
    form{background:rgba(255,255,255,0.05);padding:20px;border-radius:8px;max-width:400px;margin:auto}
    form input{width:100%;padding:8px;margin-bottom:10px;border-radius:6px;border:none;background:rgba(255,255,255,0.1);color:#fff}
    form button{width:100%}
    .profile-box{background:rgba(255,255,255,0.05);padding:20px;border-radius:8px;max-width:700px;margin:auto}
    .order{border:1px solid rgba(255,255,255,0.1);padding:10px;border-radius:6px;margin-bottom:10px}
    .status{color:#06b6d4}
  </style>
</head>
<body>
  <header>
    <div class="logo">Mini Commerce</div>
    <div>
      <button class="btn ghost" onclick="showPage('home')">Home</button>
      <button class="btn ghost" id="loginNav" onclick="showPage('login')">Login</button>
      <button class="btn ghost" id="registerNav" onclick="showPage('register')">Register</button>
      <button class="btn ghost hidden" id="profileNav" onclick="showPage('profile')">Profile</button>
      <button class="btn ghost hidden" id="logoutBtn" onclick="logout()">Logout</button>
      <button class="btn" id="openCart">Cart</button>
    </div>
  </header>

  <main class="container">
    <!-- Home -->
    <section id="homePage">
      <h1>Products</h1>
      <div class="cards" id="productGrid"></div>
    </section>

    <!-- Login -->
    <section id="loginPage" class="hidden">
      <form id="loginForm">
        <h2>Login</h2>
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button class="btn" type="submit">Login</button>
      </form>
    </section>

    
    </section>

    <!-- Profile -->
    <section id="profilePage" class="hidden">
      <div class="profile-box">
        <h2>Profile</h2>
        <p><strong>Name:</strong> <span id="profName"></span></p>
        <p><strong>Email:</strong> <span id="profEmail"></span></p>

        <div id="adminUsers" class="hidden" style="margin-top:20px;">
          <h3>All Users</h3>
          <div id="userList"></div>
        </div>

        <h3 id="orderTitle">Order History</h3>
        <div id="orderList"></div>
      </div>
    </section>
  </main>

  <!-- Cart Sidebar -->
  <aside class="sidebar" id="cartSidebar">
    <h2>Cart</h2>
    <div id="cartList"></div>
    <p>Subtotal: â‚¹<span id="subtotal">0</span></p>
    <p>GST (18%): â‚¹<span id="tax">0</span></p>
    <p><strong>Total: â‚¹<span id="total">0</span></strong></p>
    <button class="btn" id="checkout">Checkout</button>
    <button class="btn ghost" id="closeCart">Close</button>
  </aside>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

  <script>
    // ðŸ”¥ à¤¤à¥à¤® à¤…à¤ªà¤¨à¤¾ config à¤¯à¤¹à¤¾à¤‚ à¤¡à¤¾à¤²à¤¨à¤¾
    const firebaseConfig = {
  apiKey: "AIzaSyB-1YDBenuISUmkcj3BME-JoU4q1WvZb2I",
  authDomain: "dgitel-store.firebaseapp.com",
  databaseURL: "https://dgitel-store-default-rtdb.firebaseio.com",
  projectId: "dgitel-store",
  storageBucket: "dgitel-store.firebasestorage.app",
  messagingSenderId: "35534831141",
  appId: "1:35534831141:web:04791cb4a57a66e154c9cc"
};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const R=s=>document.querySelector(s);
    const pages={home:R('#homePage'),login:R('#loginPage'),register:R('#registerPage'),profile:R('#profilePage')};

    let currentUser=null;
    let cart={};

    function showPage(p){Object.values(pages).forEach(x=>x.classList.add('hidden'));pages[p].classList.remove('hidden');if(p==='profile')loadProfile();}
    function updateNav(){if(currentUser){R('#loginNav').classList.add('hidden');R('#registerNav').classList.add('hidden');R('#logoutBtn').classList.remove('hidden');R('#profileNav').classList.remove('hidden')}else{R('#loginNav').classList.remove('hidden');R('#registerNav').classList.remove('hidden');R('#logoutBtn').classList.add('hidden');R('#profileNav').classList.add('hidden')}}

    // Products
    const products=[
      {id:'p1',name:'Sneakers',price:1799,desc:'Lightweight running sneakers.',img:'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400'},
      {id:'p2',name:'Backpack',price:2499,desc:'Water-resistant laptop backpack.',img:'https://images.unsplash.com/photo-1563306406-9ad8df06b1a0?w=400'},
      {id:'p3',name:'Watch',price:3299,desc:'Minimal analog wristwatch.',img:'https://images.unsplash.com/photo-1519744792095-2f2205e87b6f?w=400'},
      {id:'p4',name:'Headphones',price:3999,desc:'Noise cancelling over-ear headphones.',img:'https://images.unsplash.com/photo-1518444021971-cc0fc1a6a72a?w=400'}
    ];
    function renderProducts(){const grid=R('#productGrid');grid.innerHTML='';products.forEach(p=>{grid.innerHTML+=`<div class='product'><img src="${p.img}"><h3>${p.name}</h3><p>${p.desc}</p><div>â‚¹${p.price}</div><button class='btn' onclick='addToCart("${p.id}")'>Add</button></div>`})}

    function addToCart(id){if(!currentUser){alert('Login first');return}const p=products.find(x=>x.id===id);if(!cart[id])cart[id]={...p,qty:0};cart[id].qty++;renderCart()}
    function renderCart(){const list=R('#cartList');list.innerHTML='';let subtotal=0;Object.values(cart).forEach(it=>{subtotal+=it.price*it.qty;list.innerHTML+=`<div class='cart-item'><img src='${it.img}'><div>${it.name}<br>â‚¹${it.price} x ${it.qty}</div></div>`});const tax=Math.round(subtotal*0.18);R('#subtotal').textContent=subtotal;R('#tax').textContent=tax;R('#total').textContent=subtotal+tax}

    R('#openCart').onclick=()=>R('#cartSidebar').classList.add('open');
    R('#closeCart').onclick=()=>R('#cartSidebar').classList.remove('open');

    // Checkout â†’ Save order in Firestore
    R('#checkout').onclick=async()=>{
      if(!currentUser){alert('Login required');return}
      if(Object.keys(cart).length===0){alert('Cart empty');return}
      const order={items:cart,date:new Date().toLocaleString(),total:R('#total').textContent,status:"Processing",userEmail:currentUser.email};
      await db.collection("orders").add(order);
      cart={};renderCart();alert("Order placed!");
    }

    // Register
    R('#registerForm').onsubmit=async e=>{
      e.preventDefault();
      const name=R('#regName').value,email=R('#regEmail').value,pw=R('#regPassword').value,cpw=R('#regConfirm').value;
      if(pw!==cpw){alert("Passwords don't match");return}
      try{
        const cred=await auth.createUserWithEmailAndPassword(email,pw);
        await db.collection("users").doc(cred.user.uid).set({name,email,role: email==="admin@shop.com"?"admin":"user"});
        alert("Registered! Now login");showPage('login');
      }catch(err){alert(err.message)}
    }

    // Login
    R('#loginForm').onsubmit=async e=>{
      e.preventDefault();
      const email=R('#loginEmail').value,pw=R('#loginPassword').value;
      try{
        await auth.signInWithEmailAndPassword(email,pw);
      }catch(err){alert(err.message)}
    }

    // Auth state listener
    auth.onAuthStateChanged(async user=>{
      if(user){
        const snap=await db.collection("users").doc(user.uid).get();
        currentUser=snap.data();showPage('home');updateNav();
      }else{
        currentUser=null;updateNav();showPage('login');
      }
    });

    async function logout(){await auth.signOut();}

    // Load profile + orders
    async function loadProfile(targetEmail=null){
      if(!currentUser) return;
      R('#profName').textContent=currentUser.name;
      R('#profEmail').textContent=currentUser.email;
      const isAdmin=currentUser.email==="admin@shop.com";
      if(isAdmin){
        R('#adminUsers').classList.remove('hidden');
        const snap=await db.collection("users").get();
        const userList=R('#userList');userList.innerHTML='';
        snap.forEach(doc=>{
          let u=doc.data();
          if(u.email!=="admin@shop.com"){
            userList.innerHTML+=`<button class="btn ghost" onclick="viewUser('${u.email}')">${u.name} (${u.email})</button><br>`;
          }
        });
      } else {R('#adminUsers').classList.add('hidden');}
      loadOrders(targetEmail||currentUser.email,isAdmin);
    }

    async function loadOrders(email,isAdmin){
      const list=R('#orderList');list.innerHTML='';
      const snap=await db.collection("orders").where("userEmail","==",email).get();
      if(snap.empty){list.innerHTML='<p>No orders</p>';return}
      snap.forEach(doc=>{
        const o=doc.data();
        let items=Object.values(o.items).map(it=>`${it.name} x ${it.qty}`).join(', ');
        if(isAdmin){
          list.innerHTML+=`
            <div class="order">
              <h4>${o.date}</h4>
              <p>${items}</p>
              <p><strong>Total: â‚¹${o.total}</strong></p>
              <label>Status:
                <select onchange="updateStatus('${doc.id}',this.value)">
                  <option ${o.status==='Processing'?'selected':''}>Processing</option>
                  <option ${o.status==='Shipped'?'selected':''}>Shipped</option>
                  <option ${o.status==='Delivered'?'selected':''}>Delivered</option>
                </select>
              </label>
            </div>`;
        } else {
          list.innerHTML+=`
            <div class="order">
              <h4>${o.date}</h4>
              <p>${items}</p>
              <p><strong>Total: â‚¹${o.total}</strong></p>
              <p class="status">Status: ${o.status}</p>
            </div>`;
        }
      });
    }

    async function updateStatus(orderId,newStatus){
      await db.collection("orders").doc(orderId).update({status:newStatus});
      loadProfile();
    }

    function viewUser(email){loadOrders(email,true);}

    renderProducts();renderCart();
  </script>
</body>
</html>